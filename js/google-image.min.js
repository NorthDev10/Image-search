var DownloadImgUrl=function(){function k(c,a){var b=r(c,a);$("#pagination").html("");if(0<Object.keys(b).length){var d='<div class="btn-group">';$.each(b,function(b,a){d="..."==a?d+'</div><div class="btn-group">':c==a?d+('<span class="active btn btn-default">'+a+"</span>"):d+('<a class="btn btn-default" onClick="DownloadImgUrl.printImages(\''+a+"');\">"+a+"</a>")});d+="</div>";$("#pagination").html(d)}}function h(c,a){var b=document.createElement("a");b.href=a;$.getJSON("/stop-words.json",function(d){for(var a=
0;a<d.length;a++)if(-1<b.hostname.indexOf(d[a])){$("#ib"+c).css("background","#F8C804");break}})}function l(c){c=c.replace(/&/g,"&amp;");c=c.replace(/</g,"&lt;");c=c.replace(/>/g,"&gt;");return c=c.replace(/"/g,"&quot;")}function r(c,a){if(0==a||1==a)return[];var b=[];if(10<a)if(4>=c||c+3>=a){for(var d=0;4>=d;d++)b[d]=d+1;b[5]="...";for(var d=6,e=4;10>=d;d++,e--)b[d]=a-e}else b[0]=1,b[1]=2,b[2]="...",b[3]=c-2,b[4]=c-1,b[5]=c,b[6]=c+1,b[7]=c+2,b[8]="...",b[9]=a-1,b[10]=a;else for(d=0;d<a;d++)b[d]=
d+1;return b}function t(c,a,b){var d,e,f,m,p,g,n;void 0!=b&&$("#iamgeList").html("");$.each(a.items,function(b,a){e=c+b+'.<a target="_blank" title="'+l(a.title)+'" href="'+a.link+'"><img alt="'+l(a.title)+'" class="preview-image" src="'+a.link+'"></a>';f='<input class="css-checkbox" id="cb'+(c+b)+'" onclick="DownloadImgUrl.addImgToList(\''+a.link+"','"+(c+b)+"','"+a.image.contextLink+'\');" type="checkbox"><label for="cb'+(c+b)+'" class="css-label margin5">\u0412\u044b\u0431\u0440\u0430\u0442\u044c</label>';
m="<p>\u0420\u0430\u0437\u043c\u0435\u0440: "+a.image.width+"x"+a.image.height+"</p>";p='<input title="\u0417\u0430\u0433\u043e\u043b\u043e\u0432\u043e\u043a \u0441\u0442\u0440\u0430\u043d\u0438\u0446\u044b \u0441 \u0434\u0430\u043d\u043d\u043e\u0439 \u043a\u0430\u0440\u0442\u0438\u043d\u043a\u043e\u0439" type="text" class="form-control input-style" value="'+l(a.title)+'">';g='<input title="\u0421\u0441\u044b\u043b\u043a\u0430 \u043d\u0430 \u044d\u0442\u0443 \u043a\u0430\u0440\u0442\u0438\u043d\u043a\u0443" type="text" class="form-control input-style" value="'+
a.link+'">';n='<input title="\u0421\u0442\u0440\u0430\u043d\u0438\u0446\u0430 \u0441 \u044d\u0442\u043e\u0439 \u043a\u0430\u0440\u0442\u0438\u043d\u043a\u043e\u0439" type="text" class="form-control input-style" value="'+a.image.contextLink+'">';d='<div id="ib'+(c+b)+'" class="imageBlock img-thumbnail">'+e+m+p+g+n+f+"</div>";$("#iamgeList").append(d);h(c+b,a.link)});q=c+a.items.length}function u(c){try{var a=JSON.parse(c);if(void 0!=a.error)throw a.error;var b,d,e=0;$.each(a,function(a,c){d='<img class="preview-image" src="'+
c.url+"?rand="+Math.round((new Date).getTime()/1E3)+e+'">';b='<div class="imageBlock img-thumbnail">'+d+"</div>";$("#downloadedImg").append(b);e++});for(e=0;e<q;e++)$("#cb"+e).prop("checked")&&($("#cb"+e).prop("checked",!1),delete g[e]);$("#uploadIMG input").show();$("#uploadIMG .displayHide").hide()}catch(f){$("#uploadIMG input").show(),$("#uploadIMG .displayHide").hide(),$("#downloadedImg").append('<div class="alert alert-warning alert-dismissable"><button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button>\u041d\u0435 \u0443\u0434\u0430\u043b\u043e\u0441\u044c \u0437\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u044c \u043a\u0430\u0440\u0442\u0438\u043d\u043a\u0438 =(<p>'+
f+"</p></div>")}}var e=0,f=[],g={},q=0;return{sendUrlImage:function(){if(0<Object.keys(g).length){var c=JSON.stringify(g);$.post("?q=send-download",{imgUrl:c,folderName:$("#folderName").val(),keyword:f[e]},u);$("#uploadIMG input").hide();$("#uploadIMG .displayHide").show()}},addImgToList:function(c,a,b){void 0!=c?$("#cb"+a).prop("checked")?g[a]={id:a,url:c,oUrlSite:b}:delete g[a]:$("#"+a).attr("checked",!1)},getImg:function(c,a){try{void 0===c&&(c=1);void 0!=a&&($("#downloadedImg").html(""),$("#folderName").val(""),
g={});var b="",d=f[e].replace(/,\s?/g,"|");if(!(0<d.length))throw"\u0417\u0430\u0434\u0430\u043d \u043f\u0443\u0441\u0442\u043e\u0439 \u043f\u043e\u0438\u0441\u043a\u043e\u0432\u044b\u0439 \u0437\u0430\u043f\u0440\u043e\u0441";null!=$("#searchSettings").val()&&(b+="&"+$("#searchSettings").val().join("&"));null!=$("#noSearchDomain").val()&&(d+=" "+$("#noSearchDomain").val().join(" "));if($("#blackDomains").prop("checked"))var k=$.ajax({url:"black-domains.json",async:!1}),d=d+(" -site:"+$.parseJSON(k.responseText).join(" -site:"));
null!=$("#countryID").val()&&(b+="&cr="+$("#countryID").val().join("|"));1<$("#searchSite").val().length&&(b+="&siteSearch="+encodeURIComponent($("#searchSite").val()));var h="ajax-image-search.php?q="+encodeURIComponent(d)+"&start="+c+b;$.ajax({url:h,dataType:"text",success:function(b){try{b=JSON.parse(b);if(void 0!=b.error)throw b.error;if(0<b.searchInformation.totalResults)t(c,b,a),void 0!=b.queries.nextPage?$("#pageNav").html('<input type="button" class="btn btn-info" onclick="DownloadImgUrl.getImg('+
b.queries.nextPage[0].startIndex+', undefined);" value="\u041f\u043e\u043a\u0430\u0437\u0430\u0442\u044c \u0435\u0449\u0451">'):$("#pageNav").html("");else throw"\u041d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d\u043e \u043d\u0438 \u043e\u0434\u043d\u043e\u0433\u043e \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u044f \u043f\u043e \u0437\u0430\u043f\u0440\u043e\u0441\u0443 <b>"+f[e]+"</b>.";}catch(d){$("#iamgeList").html('<div class="alert alert-warning">'+d+"</div>")}},error:function(b){}})}catch(m){$("#iamgeList").html('<div class="alert alert-warning">'+
m+"</div>")}},initArrayKeyWords:function(){document.getElementById("textBlock")&&(f=document.getElementById("textBlock").value.split("\n"),e>=f.length&&(e=0),1>e?($(".previousLineKeyWords").text(""),$(".previousLineKeyWords").css("height","30px")):($(".previousLineKeyWords").css("height","none"),$(".previousLineKeyWords").text(f[e-1])),$(".currentLineKeyWords").text(f[e]),e+1<f.length?$(".nextLineKeyWords").text(f[e+1]):($(".nextLineKeyWords").text(""),$(".nextLineKeyWords").css("height","30px")))},
previousLineBtn:function(){0<e&&(0<=e-2?($(".previousLineKeyWords").css("height","none"),$(".previousLineKeyWords").text(f[e-2])):($(".previousLineKeyWords").text(""),$(".previousLineKeyWords").css("height","30px")),$(".currentLineKeyWords").text(f[e-1]),$(".nextLineKeyWords").text(f[e]),e--)},nextLineBtn:function(){e+1<f.length&&($(".previousLineKeyWords").text(f[e]),$(".currentLineKeyWords").text(f[e+1]),e+2<f.length?($(".nextLineKeyWords").css("height","none"),$(".nextLineKeyWords").text(f[e+2])):
($(".nextLineKeyWords").text(""),$(".nextLineKeyWords").css("height","30px")),e++)},printImages:function(c){document.getElementById("downloaded-pictures")&&$.post("?q=get-json-imgs",{page:c,"number-imgs":$("#numImgOnPage").val()},function(a){try{var b=JSON.parse(a);if(b.error)$("#downloaded-pictures").html('<div class="alert alert-info">'+b.error+"</div>");else{var d,e,f,g,h,l;$("#downloaded-pictures").html("");$.each(b.img,function(b,a){e='<a target="_blank" title="'+a.KeyWords+'" href="'+a.ImageLink+
'"><img alt="'+a.KeyWords+'" class="preview-image" src="'+a.ImageLink+'"></a>';f='<input title="\u0421\u0441\u044b\u043b\u043a\u0430 \u043d\u0430 \u044d\u0442\u0443 \u043a\u0430\u0440\u0442\u0438\u043d\u043a\u0443" type="text" class="form-control input-style" value="'+location.protocol+"//"+location.hostname+a.ImageLink+'">';g='<input title="\u041e\u0440\u0438\u0433\u0438\u043d\u0430\u043b\u044c\u043d\u0430\u044f \u0441\u0441\u044b\u043b\u043a\u0430 \u043d\u0430 \u044d\u0442\u0443 \u043a\u0430\u0440\u0442\u0438\u043d\u043a\u0443" type="text" class="form-control input-style" value="'+
a.OriginalLink+'">';h='<input title="\u0421\u0442\u0440\u0430\u043d\u0438\u0446\u0430 \u0441 \u044d\u0442\u043e\u0439 \u043a\u0430\u0440\u0442\u0438\u043d\u043a\u043e\u0439" type="text" class="form-control input-style" value="'+a.LinkPageImg+'">';l='<button type="button" data-toggle="modal" data-target=".bs-example-modal-sm" onclick="DownloadImgUrl.removesImg(\''+(b.toString()+a.RequestID)+"', '"+a.RequestID+"', '"+a.ImageLink+'\')" class="btn btn-danger">\u0423\u0434\u0430\u043b\u0438\u0442\u044c</button>';
d='<div id="cb'+(b.toString()+a.RequestID)+'" class="imageBlock img-thumbnail">'+e+f+g+h+l+"</div>";$("#downloaded-pictures").append(d)});k(c,b.countPages)}}catch(n){$("#downloaded-pictures").html('<div class="alert alert-danger">\u041d\u0435 \u0443\u0434\u0430\u043b\u043e\u0441\u044c \u0437\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u044c \u043a\u0430\u0440\u0442\u0438\u043d\u043a\u0438 =(</div>')}})},removesImg:function(c,a,b){confirm("\u0412\u044b \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u0442\u0435\u043b\u044c\u043d\u043e \u0445\u043e\u0442\u0438\u0442\u0435 \u0443\u0434\u0430\u043b\u0438\u0442\u044c \u044d\u0442\u043e \u0438\u0437\u043e\u0431\u0440\u0430\u0436\u0435\u043d\u0438\u0435?")&&
void 0!=b&&void 0!=a&&$.post("index.php?q=removes-img",{"request-key-words-id":a,"img-url":b},function(a){a=JSON.parse(a);a.status?$("#cb"+c).remove():alert("\u041d\u0435 \u0443\u0434\u0430\u043b\u043e\u0441\u044c \u0443\u0434\u0430\u043b\u0438\u0442\u044c \u043a\u0430\u0440\u0442\u0438\u043d\u043a\u0443")})}}}();
$(document).ready(function(){$(window).scroll(function(){var k=$(this).scrollTop();100<k?$("#back-top").fadeIn():$("#back-top").fadeOut();var h=$("#topNav");240>k?h.css("display","none"):h.css("display","block")});$("#back-top").click(function(){$("body,html").animate({scrollTop:0},800);return!1});DownloadImgUrl.printImages(1,10);DownloadImgUrl.initArrayKeyWords()});